- name: Gather facts
  import_playbook: ../facts.yml
  
- hosts: all
  become: yes
  serial: 10
  roles:
    - name: systemBootstrap
      tags: system

- hosts: all
  strategy: linear
  any_errors_fatal: "{{ any_errors_fatal | default(true) }}"
  gather_facts: false
  environment: "{{ proxy_disable_env }}"
  roles:
    - { role: kubespray-defaults }
    - { role: cluster/bootstrap-os, tags: bootstrap-os}
    - { role: bootstrap-os, tags: bootstrap-os}

- hosts: k8s_cluster:etcd
  gather_facts: False
  any_errors_fatal: "{{ any_errors_fatal | default(true) }}"
  environment: "{{ proxy_disable_env }}"
  roles:
    - { role: kubespray-defaults }
    - { role: kubernetes/preinstall, tags: preinstall }
    - { role: cluster/kubernetes/preinstall, tags: preinstall }
    - { role: "container-engine", tags: "container-engine", when: deploy_container_engine|default(true) }
    - { role: download, tags: download, when: "not skip_downloads" }
    - { role: cluster/download, tags: download, when: "not skip_downloads" }
